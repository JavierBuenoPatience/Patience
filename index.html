<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patience - Biología y Geología</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left">Patience</div>
      <img src="assets/logo.png" alt="Logo" class="header-right" onclick="showHomeScreen()"> <!-- Asegúrate de que la ruta del logo sea correcta -->
    </header>
    <div class="main-content">
      <!-- Menú Lateral -->
      <nav id="sidebar" style="display: none;">
        <ul>
          <li><a href="#" onclick="showProfile()">Perfil</a></li>
          <li><a href="#" onclick="redirectToURL('https://chatgpt.com/g/g-xgl7diXqb-patience-biologia-y-geologia')">pAtIence</a></li>
          <li><a href="#" onclick="showComingSoon()">Mi centro</a></li>
          <li><a href="#" onclick="redirectToURL('https://www.csif.es/es/portada/andalucia/educacion')">Últimas noticias</a></li>
          <li><a href="#" onclick="handleLogout()">Cerrar sesión</a></li>
        </ul>
      </nav>

      <main>
        <!-- Pantalla de Inicio de Sesión -->
        <section id="login-screen">
          <h2>Inicio de Sesión</h2>
          <form id="login-form" onsubmit="handleLogin(event)">
            <label for="login-email">Correo Electrónico:</label>
            <input type="email" id="login-email" name="email" required>
            <label for="login-password">Contraseña:</label>
            <input type="password" id="login-password" name="password" required>
            <button type="submit">Iniciar Sesión</button>
          </form>
          <p>¿No tienes una cuenta todavía? <button type="button" onclick="showRegistrationScreen()">Regístrate!</button></p>
        </section>

        <!-- Pantalla de Registro -->
        <section id="registration-screen" style="display: none;">
          <h2>Registro</h2>
          <form id="registration-form" onsubmit="handleRegistration(event)">
            <label for="reg-name">Nombre:</label>
            <input type="text" id="reg-name" name="name" required>
            <label for="reg-email">Correo Electrónico:</label>
            <input type="email" id="reg-email" name="email" required>
            <label for="reg-password">Contraseña:</label>
            <input type="password" id="reg-password" name="password" required>
            <button type="submit">Registrarse</button>
          </form>
          <p id="registration-message" style="display: none;">Genial! Gracias por registrarte. Recibirás un email de confirmación para poder comenzar!</p>
          <button id="welcome-button" class="welcome-button" style="display: none;" onclick="showHomeScreen()">Bienvenid@!</button>
        </section>

        <!-- Pantalla de Inicio -->
        <section id="home-screen" style="display: none;">
          <h1>Bienvenid@, <span id="user-name-home"></span>!</h1>
          <div class="buttons-container">
            <button class="welcome-button" onclick="redirectToURL('https://chatgpt.com/g/g-xgl7diXqb-patience-biologia-y-geologia')">Apóyate en la IA</button>
            <button class="welcome-button" onclick="redirectToURL('https://www.csif.es/es/portada/andalucia/educacion')">Últimas noticias</button>
          </div>
        </section>

        <!-- Pantalla de Perfil -->
        <section id="profile-screen" style="display: none;">
          <h2>Perfil</h2>
          <form id="profile-form" onsubmit="handleProfileUpdate(event)">
            <label for="full-name">Nombre Completo:</label>
            <input type="text" id="full-name" name="full-name" required>
            <label for="profile-email">Email:</label>
            <input type="email" id="profile-email" name="profile-email" required>
            <label for="phone">Teléfono:</label>
            <input type="tel" id="phone" name="phone">
            <label for="study-time">Tiempo dedicado a la oposición:</label>
            <input type="text" id="study-time" name="study-time">
            <label for="specialty">Especialidad del cuerpo:</label>
            <input type="text" id="specialty" name="specialty">
            <button type="submit">Guardar</button>
          </form>
        </section>

        <!-- Pantalla Próximamente -->
        <section id="coming-soon-screen" style="display: none;">
          <h2>Próximamente</h2>
          <p>Esta funcionalidad estará disponible pronto.</p>
        </section>
      </main>
    </div>
    <footer>
      <p>© 2024 Patience. Todos los derechos reservados.</p>
    </footer>
  </div>
  <script>
    const users = JSON.parse(localStorage.getItem('users')) || {};

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('registered') === 'true' && localStorage.getItem('loggedIn') === 'true') {
        showHomeScreen();
      } else {
        showLoginScreen();
      }
    });

    function handleRegistration(event) {
      event.preventDefault();
      const name = document.getElementById('reg-name').value;
      const email = document.getElementById('reg-email').value;
      const password = document.getElementById('reg-password').value;

      if (!validateEmail(email)) {
        alert('Por favor, utiliza un correo de Gmail o Hotmail.');
        return;
      }

      if (users[email]) {
        alert('Correo ya registrado. Por favor, inicia sesión.');
        return;
      }

      const token = generateConfirmationToken();
      users[email] = { name, email, password, confirmed: false, profile: {}, token: token };
      localStorage.setItem('users', JSON.stringify(users));
      sendConfirmationEmail(email, token);

      document.getElementById('registration-form').reset();
      document.getElementById('registration-message').style.display = 'block';
      document.getElementById('welcome-button').style.display = 'block';
    }

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      if (!validateEmail(email)) {
        alert('Por favor, utiliza un correo de Gmail o Hotmail.');
        return;
      }

      if (users[email] && users[email].password === password) {
        if (users[email].confirmed) {
          localStorage.setItem('loggedIn', 'true');
          localStorage.setItem('email', email);
          localStorage.setItem('name', users[email].name);
          showHomeScreen();
        } else {
          alert('Por favor, confirma tu correo antes de iniciar sesión.');
        }
      } else {
        alert('Correo o contraseña incorrectos.');
      }
    }

    function handleLogout() {
      localStorage.removeItem('loggedIn');
      localStorage.removeItem('email');
      localStorage.removeItem('name');
      showLoginScreen();
    }

    function handleProfileUpdate(event) {
      event.preventDefault();
      const email = localStorage.getItem('email');
      const profile = {
        fullName: document.getElementById('full-name').value,
        phone: document.getElementById('phone').value,
        studyTime: document.getElementById('study-time').value,
        specialty: document.getElementById('specialty').value
      };
      users[email].profile = profile;
      localStorage.setItem('users', JSON.stringify(users));
      alert('Perfil actualizado con éxito');
    }

    function sendConfirmationEmail(email, token) {
      fetch('https://formspree.io/f/mjkbwdwl', { // Reemplaza con el ID de tu formulario en Formspree
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          email: email,
          message: `Confirma tu cuenta usando el siguiente enlace: http://tu-dominio.com/confirmar?token=${token}`
        })
      }).then(response => {
        if (response.ok) {
          alert('Correo de confirmación enviado. Por favor, revisa tu email.');
        } else {
          alert('Error al enviar el correo de confirmación.');
        }
      });
    }

    function validateEmail(email) {
      const gmailRegex = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
      const hotmailRegex = /^[a-zA-Z0-9._%+-]+@hotmail\.com$/;
      return gmailRegex.test(email) || hotmailRegex.test(email);
    }

    function generateConfirmationToken() {
      return Math.random().toString(36).substr(2); // Generar un token simple
    }

    function showLoginScreen() {
      hideAllScreens();
      document.getElementById('login-screen').style.display = 'block';
    }

    function showRegistrationScreen() {
      hideAllScreens();
      document.getElementById('registration-screen').style.display = 'block';
    }

    function showHomeScreen() {
      hideAllScreens();
      document.getElementById('home-screen').style.display = 'block';
      document.getElementById('sidebar').style.display = 'block';
      document.getElementById('user-name-home').textContent = localStorage.getItem('name');
    }

    function showProfile() {
      hideAllScreens();
      document.getElementById('profile-screen').style.display = 'block';
      const email = localStorage.getItem('email');
      const profile = users[email].profile || {};
      document.getElementById('full-name').value = profile.fullName || '';
      document.getElementById('phone').value = profile.phone || '';
      document.getElementById('study-time').value = profile.studyTime || '';
      document.getElementById('specialty').value = profile.specialty || '';
    }

    function showComingSoon() {
      hideAllScreens();
      document.getElementById('coming-soon-screen').style.display = 'block';
    }

    function hideAllScreens() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('registration-screen').style.display = 'none';
      document.getElementById('home-screen').style.display = 'none';
      document.getElementById('profile-screen').style.display = 'none';
      document.getElementById('coming-soon-screen').style.display = 'none';
    }

    function redirectToURL(url) {
      window.location.href = url;
    }
  </script>
</body>
</html>
